#!/bin/bash

if [ ! $1 ]; then
    cuckooContainer="myCuckooContainer"
else
    cuckooContainer="$1"
fi
if [ ! $2 ]; then
    CWD="cuckoo_default"
else
    CWD="$2"
fi

isNetworkUp=$(vboxmanage list hostonlyifs | grep -A 10 " vboxnet0" | grep "Status")
if [[ $isNetworkUp == "" ]]; then
    vboxmanage hostonlyif create
    vboxmanage hostonlyif ipconfig vboxnet0 --ip 192.168.56.1 --netmask 255.255.255.0
    #sudo ip addr 192.168.56.1/24 dev vboxnet0
    sudo ip link set vboxnet0 up
fi
if [[ $isNetworkUp == *"Down"* ]]; then
    sudo ip link set vboxnet0 up
fi

exists=$(docker ps -a --filter "name=$cuckooContainer" | grep $cuckooContainer)
if [[ "$exists" == "" ]]; then
    DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
    "$DIR/create_container.sh" "$cuckooContainer" "$CWD"
fi

isUp=$(docker ps -a --filter "name=$cuckooContainer" | grep $cuckooContainer)
if [[ $isUp == *"Exited"* ]]; then
    docker start $cuckooContainer
fi

