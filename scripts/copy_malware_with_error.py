#!/usr/bin/python3

from pprint import pprint
from package_db import *

import sys

def malware_has_error(js):
    if len(js["debug"]["errors"]) > 0:
        return True
    return False

if __name__=="__main__":
    if len(sys.argv) > 1:
        n = int(sys.argv[1])
    else:
        n = 1
    n = -n
    #add_command("names malwares not detected = ", lambda x: not is_malware_detected(0)(x), COLLECT_NAMES)
    add_command("errors_true", malware_has_error, COUNT_TRUE)
    add_command("errors", malware_has_error, COLLECT_JS)
    execute_commands()
    error_malwares = get_result("errors")
    print("malware : ", error_malwares[n]["malware_name"])
    print("".join(error_malwares[n]["debug"]["errors"]))
    print("number of malware with errors = ", get_result("errors_true"))
    #print(get_result("names malwares not detected = "))
