#!/usr/bin/python3

import pymongo
import os
import json

PORT=27017
client = pymongo.MongoClient("localhost", PORT)
db = client.cuckoo_db
collection = db.malware_results

SCRIPTS_DIR = os.path.dirname(os.path.realpath(__file__))
MAIN_DIR = os.path.join(SCRIPTS_DIR, "..")

def add_js(js):
    return collection.insert_one(js)

def clean_all_malware():
    malware_already_in_db = []
    for a in collection.find():
        ma, mo = a["malware_name"], a["monitor_name"]
        if [ma, mo] not in malware_already_in_db and ma is not None:
            malware_already_in_db.append([ma, mo])
        #elif ma == "pafish.exe":
        #    print("removing pafish")
        #    collection.delete_one(a)
        else:
            print("removing ", ma, mo)
            collection.delete_one(a)

if __name__=="__main__":
    clean_all_malware()


